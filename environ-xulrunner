# MonoDevelop seems to set PKG_CONFIG_LIBDIR to the empty string, which is bad
# for us because that eliminates most packages, including geckofx29.
# If PKG_CONFIG_LIBDIR is not set at all, then the default paths are searched.
# To be safe, we'll preserve the old value (if it is set) and restore it.
if [ "${PKG_CONFIG_LIBDIR+set}" = set ]; then
	OLD_PKG_CONFIG_LIBDIR="${PKG_CONFIG_LIBDIR}"
	unset PKG_CONFIG_LIBDIR
fi

if [ "$RUNMODE" = "INSTALLED" ]
then
	XULRUNNER=/usr/lib/fieldworks/Firefox
else
	XULRUNNER="$(find "$HOME" -name libxul.so -path */fw/Output*/Debug/Firefox* -prune)"
fi
LD_LIBRARY_PATH="${XULRUNNER}:${LD_LIBRARY_PATH}"

if [ "$RUNMODE" = "INSTALLED" ]
then
	GECKOFX=/usr/lib/fieldworks
else
	GECKOFX="${XULRUNNER}/.."
fi
export LD_PRELOAD=libgeckofix.so

if [ "${OLD_PKG_CONFIG_LIBDIR+set}" = set ]; then
	export PKG_CONFIG_LIBDIR="${OLD_PKG_CONFIG_LIBDIR}"
	unset OLD_PKG_CONFIG_LIBDIR
fi
